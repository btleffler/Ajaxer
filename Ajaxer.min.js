/**
 * Ajaxer
 * Author: Benjamin Leffler <btleffler@gmail.com>
 * Date: 09/28/12
 * Licence: MIT - <http://opensource.org/licenses/mit-license.php>
 */

(function(b){function g(a){this.options=a;this.url="";this.data={};this.method="POST";this.headers={};this.user="";this.pass="";this.responseType="json";this.callbacks=e.defaultCallbacks();this.responses=[];this.requests=[];if(!a.dontCheckForFormData)e.useFormData(true);if(typeof a.url==="string")this.url=a.url;if(typeof a.data!=="undefined")this.setData(a.data);if(typeof a.headers==="object")this.setHeaders(a.headers);if(typeof a.user==="string")this.user=a.user;if(typeof a.pass==="string")this.pass=a.pass;if(typeof a.responseType==="string")this.responseType=a.responseType;if(typeof a.method==="string")this.method=e.getHttpVerb(a.method);if(typeof a.callbacks!=="undefined")this.addCallback(a.callbacks);return this}"use strict";var c={},d,e,f;d={httpVerbs:["HEAD","GET","POST","PUT","DELETE","TRACE","OPTIONS","CONNECT","PATCH"],useFormData:typeof b.FormData!=="undefined"};e={error:function(b){throw new Error(b)},warn:function(b){if(window.console){console.warn(b)}},getXMLHttp:function(){var b=["MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],c=b.length,d=0,f;try{f=new XMLHttpRequest;return f}catch(g){for(;d<c;d++){try{f=new ActiveXObject(b[d]);return f}catch(i){}}e.error("Ajax is not supported.")}},getHttpVerb:function(b){var c=d.httpVerbs,e=c.length,f=0;b=b.trim().toUpperCase();for(;f<e;f++){if(b===c[f])return b}return"GET"},useFormData:function(c){if(c){return d.useFormData=typeof b.FormData!=="undefined"}return d.useFormData},defaultCallbacks:function(){return{before:[],after:[]}},parseJSON:function(b){if(window.JSON){return JSON.parse(b)}else{return(new Function("return "+b))()}},prepareData:function(b,c){var d,f;if(e.useFormData(c)){d=new FormData;for(f in b){if(b.hasOwnProperty(f)&&f!=="hasOwnProperty"){d.append(f,b[f])}}}else{d="";for(f in b){if(b.hasOwnProperty(f)&&f!=="hasOwnProperty"){d+=d.length?"&":"";d+=encodeURIComponent(f)+"="+encodeURIComponent(b[f])}}}return d}};f={addCallbacks:function(b,c){var d,e;if(typeof c==="undefined")c="onComplete";if(typeof b==="function"){this[c](b)}if(!isNaN(parseInt(b.length,10))){e=b.length;for(d=0;d<e;d++){this[c](b[d])}}else{for(d in b){if(b.hasOwnProperty(d)&&d!=="hasOwnProperty"){this[c](b[d])}}}},addCallback:function(b,c){if(typeof b==="function"){this.callbacks[c].push(b);return this}else if(typeof b!=="undefined")return this.addCallback({when:b});return this},callbacksOnComplete:function(b){var c=this.callbacks.after,d=c.length,e=0;for(;e<d;e++){if(c[e].call(this,b)===false){break}}},readyStateChange:function(b){var c=this;return function(){var a;if(c.readyState===4){if(c.satus===200){b.responses.push(c.responseText);a=c.response||c.responseXML;if(!a)a=e.parseJSON(c.responseText);f.callbacksOnComplete.call(b,a)}}}},setHeadersOnXhr:function(b,c){var d=this.headers,e;if(c)b.setRequestHeader("X-Requested-With","XMLHttpRequest");for(e in d){if(d.hasOwnProperty(e)&&e!=="hasOwnProperty"){b.setRequestHeader(e,d[e])}}}};c.setData=function(b,c){var d,e;if(c)this.data={};if(typeof b!=="undefined"){if(typeof b.hasOwnProperty!=="undefined"){for(d in b){if(b.hasOwnProperty(d)&&d!=="hasOwnProperty"){this.data[d]=b[d]}}}else{e=b.length;for(d=0;d<e;d++){this.data[d.toString()]=b[d]}}}return this};c.addData=c.setData;c.setHeaders=function(b,c){var d;if(c)this.headers={};for(d in b){if(b.hasOwnProperty(d)&&d!=="hasOwnProperty"){this.headers[d]=b[d]}}return this};c.addCallback=function(b,c){var d,g;if(c)this.callbacks=e.defaultCallbacks();if(typeof b==="function")this.onComplete(b);if(typeof b==="object"){d=b.before;g=b.after;if(typeof d!=="undefined")f.addCallbacks.call(this,d,"beforeSend");if(typeof g!=="undefined")f.addCallbacks.call(this,g,"onComplete");if(typeof d==="undefined"&&typeof g==="undefined")f.addCallbacks.call(this,b,"onComplete")}return this};c.beforeSend=function(b){return f.addCallback.call(this,b,"before")};c.onComplete=function(b){return f.addCallback.call(this,b,"after")};c.go=function(b){var c=e.getXMLHttp(),d=this.callbacks.before,g=d.length,i=0,j=e.prepareData(this.data);if(typeof b!=="undefined")this.addCallback(b);for(;i<g;i++){if(false===d[i].call(this,c)){return}}c.addEventListener("readystatechange",f.readyStateChange(this));c.open(this.method,this.url,true,this.userName,this.password);f.setHeadersOnXhr.call(this,c,true);c.send(j);this.requests.push(c);return this};g.createAjaxer=function(b){return new g(b)};g.prototype=c;if(typeof b.Ajaxer==="undefined"){b.Ajaxer=g}})(window)
