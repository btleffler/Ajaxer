/*
 * Ajaxer
 * Author: Benjamin Leffler <btleffler@gmail.com>
 * Date: 09/28/12
 * Uses: Cross-Browser XMLHttpRequest Creation by Joshua Eichorn <http://www.informit.com/articles/article.aspx?p=667416&seqNum=2>
 * Licence: MIT - <http://opensource.org/licenses/mit-license.php>
 */

(function(t){"use strict";function o(e){this.options=e;this.url="";this.data={};this.method="POST";this.headers={};this.user="";this.pass="";this.responseType="json";this.callbacks=i.defaultCallbacks();this.responses=[];this.requests=[];if(!e.dontCheckForFormData)i.useFormData(true);if(typeof e.url==="string")this.url=e.url;if(typeof e.data!=="undefined")this.setData(e.data);if(typeof e.headers==="object")this.setHeaders(e.headers);if(typeof e.user==="string")this.user=e.user;if(typeof e.pass==="string")this.pass=e.pass;if(typeof e.responseType==="string")this.responseType=e.responseType;if(typeof e.method==="string")this.method=i.getHttpVerb(e.method);if(typeof e.callbacks!=="undefined")this.addCallback(e.callbacks);return this}var n={},r,i,s;r={httpVerbs:["HEAD","GET","POST","PUT","DELETE","TRACE","OPTIONS","CONNECT","PATCH"],useFormData:typeof t.FormData!=="undefined"};i={error:function(t){throw new Error(t)},warn:function(t){if(window.console){console.warn(t)}},getXMLHttp:function(){var t=["MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=t.length,r=0,s;try{s=new XMLHttpRequest;return s}catch(o){for(;r<n;r++){try{s=new ActiveXObject(t[r]);return s}catch(u){}}i.error("Ajax is not supported.")}},getHttpVerb:function(t){var n=r.httpVerbs,i=n.length,s=0;t=t.trim().toUpperCase();for(;s<i;s++){if(t===n[s])return t}return"GET"},useFormData:function(n){if(n){return r.useFormData=typeof t.FormData!=="undefined"}return r.useFormData},defaultCallbacks:function(){return{before:[],after:[]}},parseJSON:function(t){if(window.JSON){return JSON.parse(t)}else{return(new Function("return "+t))()}},prepareData:function(t,n){var r,s;if(i.useFormData(n)){r=new FormData;for(s in t){if(t.hasOwnProperty(s)&&s!=="hasOwnProperty"){r.append(s,t[s])}}}else{r="";for(s in t){if(t.hasOwnProperty(s)&&s!=="hasOwnProperty"){r+=r.length?"&":"";r+=encodeURIComponent(s)+"="+encodeURIComponent(t[s])}}}return r}};s={addCallbacks:function(t,n){var r,i;if(typeof n==="undefined")n="onComplete";if(typeof t==="function"){this[n](t)}if(!isNaN(parseInt(t.length,10))){i=t.length;for(r=0;r<i;r++){this[n](t[r])}}else{for(r in t){if(t.hasOwnProperty(r)&&r!=="hasOwnProperty"){this[n](t[r])}}}},addCallback:function(t,n){var r;if(typeof t==="function"){this.callbacks[n].push(t);return this}else if(typeof t!=="undefined"){r={};r[n]=t;return this.addCallback(r)}return this},callbacksOnComplete:function(t){var n=this.callbacks.after,r=n.length,i=0;for(;i<r;i++){if(n[i].call(this,t)===false){break}}},readyStateChange:function(t){var n=this;return function(){var e;if(n.readyState===4){if(n.satus===200){t.responses.push(n.responseText);e=n.response||n.responseXML;if(!e)e=i.parseJSON(n.responseText);s.callbacksOnComplete.call(t,e)}}}},setHeadersOnXhr:function(t,n){var r=this.headers,i;if(n)t.setRequestHeader("X-Requested-With","XMLHttpRequest");for(i in r){if(r.hasOwnProperty(i)&&i!=="hasOwnProperty"){t.setRequestHeader(i,r[i])}}}};n.setData=function(t,n){var r,i;if(n)this.data={};if(typeof t!=="undefined"){if(typeof t.hasOwnProperty!=="undefined"){for(r in t){if(t.hasOwnProperty(r)&&r!=="hasOwnProperty"){this.data[r]=t[r]}}}else{i=t.length;for(r=0;r<i;r++){this.data[r.toString()]=t[r]}}}return this};n.addData=n.setData;n.setHeaders=function(t,n){var r;if(n)this.headers={};for(r in t){if(t.hasOwnProperty(r)&&r!=="hasOwnProperty"){this.headers[r]=t[r]}}return this};n.addCallback=function(t,n){var r,o;if(n)this.callbacks=i.defaultCallbacks();if(typeof t==="function")this.onComplete(t);if(typeof t==="object"){r=t.before;o=t.after;if(typeof r!=="undefined")s.addCallbacks.call(this,r,"beforeSend");if(typeof o!=="undefined")s.addCallbacks.call(this,o,"onComplete");if(typeof r==="undefined"&&typeof o==="undefined")s.addCallbacks.call(this,t,"onComplete")}return this};n.beforeSend=function(t){return s.addCallback.call(this,t,"before")};n.onComplete=function(t){return s.addCallback.call(this,t,"after")};n.go=function(t){var n=i.getXMLHttp(),r=this.callbacks.before,o=r.length,u=0,a=i.prepareData(this.data);if(typeof t!=="undefined")this.addCallback(t);for(;u<o;u++){if(false===r[u].call(this,n)){return}}n.addEventListener("readystatechange",s.readyStateChange(this));n.open(this.method,this.url,true,this.userName,this.password);s.setHeadersOnXhr.call(this,n,true);n.send(a);this.requests.push(n);return this};o.createAjaxer=function(t){return new o(t)};o.prototype=n;if(typeof t.Ajaxer==="undefined"){t.Ajaxer=o}})(window)
